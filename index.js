(()=>{var K=Object.defineProperty,Q=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var P=(r,n,a)=>n in r?K(r,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[n]=a,S=(r,n)=>{for(var a in n||(n={}))Z.call(n,a)&&P(r,a,n[a]);if(b)for(var a of b(n))tt.call(n,a)&&P(r,a,n[a]);return r},C=(r,n)=>Q(r,Y(n));(function(){"use strict";var r=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"area-git-changes-list"},[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v(t._s(t.finalHeadline))]),t.list.length?e("k-button-group",[e("k-button",{attrs:{icon:"share",link:t.link}},[t._v("Open")])],1):t._e()],1),t.list.length?e("k-items",{attrs:{layout:t.list}},t._l(t.list,function(i){return e("k-item",{key:i.icon,attrs:{text:i.text,image:{back:"none",icon:i.icon}}})}),1):[e("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])]],2)},n=[];function a(t,s,e,i,h,f,v,W){var o=typeof t=="function"?t.options:t;s&&(o.render=s,o.staticRenderFns=e,o._compiled=!0),i&&(o.functional=!0),f&&(o._scopeId="data-v-"+f);var u;if(v?(u=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(l=__VUE_SSR_CONTEXT__),h&&h.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(v)},o._ssrRegister=u):h&&(u=W?function(){h.call(this,(o.functional?this.parent:this).$root.$options.shadowRoot)}:h),u)if(o.functional){o._injectStyles=u;var B=o.render;o.render=function(J,$){return u.call($),B(J,$)}}else{var k=o.beforeCreate;o.beforeCreate=k?[].concat(k,u):[u]}return{exports:t,options:o}}let c=["site.changeTitle","page.changeTitle","page.changeStatus","model.update"];function d(){return{total:0,added:0,untracked:0,modified:0,renamed:0,deleted:0}}const x={data:()=>({headline:null,stats:d()}),computed:{finalHeadline(){let t=this.headline;return this.stats.total&&(t+=` (${this.stats.total} changes)`),t},link(){return window.panel.$url("git").toString()},positiveStatus(){let t=[];return this.stats.added&&t.push(`${this.stats.added} added`),this.stats.untracked&&t.push(`${this.stats.untracked} untracked`),t.length?t.join(", "):null},noticeStatus(){let t=[];return this.stats.modified&&t.push(`${this.stats.modified} modified`),this.stats.renamed&&t.push(`${this.stats.renamed} renamed`),t.length?t.join(", "):null},negativeStatus(){return this.stats.deleted?`${this.stats.deleted} deleted`:null},list(){let t=[];return this.negativeStatus&&t.push({icon:"trash",text:this.negativeStatus}),this.noticeStatus&&t.push({icon:"edit",text:this.noticeStatus}),this.positiveStatus&&t.push({icon:"copy",text:this.positiveStatus}),t}},created(){this.load().then(t=>{this.headline=t.headline,this.status()}),this.$events.$on(c,this.status)},destroyed(){this.$events.$off(c,this.status)},methods:{status(){this.$api.get("git/status").then(t=>{this.stats=d(),t.length&&this.updateStats(t)})},updateStats(t){this.stats.total=t.length,t.forEach(s=>{switch(s.staged||s.unstaged){case"A":this.stats.added++;break;case"?":this.stats.untracked++;break;case"M":this.stats.modified++;break;case"R":this.stats.renamed++;break;case"D":this.stats.deleted++}})}}},g={};var D=a(x,r,n,!1,w,null,null,null);function w(t){for(let s in g)this[s]=g[s]}var y=function(){return D.exports}(),R=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"area-git-changes-list"},[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v(t._s(t.title))]),t._t("action")],2),t.entries?e("k-items",{attrs:{layout:t.list}},t._l(t.entries,function(i){return e("k-item",{key:i.file,attrs:{text:i.file,image:{back:"none",icon:i.icon}}})}),1):[e("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])],e("k-pagination",{attrs:{align:"center",details:!0,page:t.pageIdx+1,total:t.data.length,limit:t.perPage},on:{paginate:t.changePage}})],2)},E=[],et="";const I={props:{title:{type:String},data:{type:Array}},data(){return{perPage:15,pageIdx:0}},computed:{pages(){return this.data.reduce((t,s,e)=>{let i=Math.floor(e/this.perPage);return(t[i]||(t[i]=[])).push(s),t},[])},page(){return this.pages[this.pageIdx]||(this.pageIdx=0),this.pages[this.pageIdx]},entries(){return this.page?this.page.map(t=>({file:t.file,mode:t.mode,icon:this.getIcon(t.mode)})):null}},methods:{changePage(t){this.pageIdx=t.page-1},getIcon(t){let s="dots";switch(t){case"?":case"A":s="copy";break;case"M":s="edit";break;case"R":s="refresh";break;case"D":s="trash"}return s}}},m={};var M=a(I,R,E,!1,F,null,null,null);function F(t){for(let s in m)this[s]=m[s]}var j=function(){return M.exports}(),L=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v("Commits")]),t._t("action")],2),t.data&&t.commits.length?e("k-items",{attrs:{layout:t.list}},t._l(t.commits,function(i){return e("k-item",{key:i.hash,attrs:{text:i.subject,info:i.hash}})}),1):[e("k-empty",{attrs:{icon:"circle-filled"}},[t._v("No commits")])],t.data?e("k-pagination",t._g({attrs:{align:"center",details:!0,page:t.page,total:t.data.total,limit:t.limit}},t.$listeners)):t._e()],2)},T=[],st="";const N={props:{data:Object},data(){return{page:1,limit:15}},computed:{commits(){return this.data.commits.map(t=>{let s=t.new?"upload":"circle-filled";return C(S({},t),{icon:s})})}},created(){this.$emit("paginate",{page:this.page,limit:this.limit})}},p={};var A=a(N,L,T,!1,O,null,null,null);function O(t){for(let s in p)this[s]=p[s]}var V=function(){return A.exports}(),U=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("k-inside",[e("k-view",[e("k-header",[t._v("Version Control")]),e("k-grid",{attrs:{gutter:"medium"}},[e("k-column",{attrs:{width:"1/3"}},[e("changes-list",{attrs:{title:"Unstaged",data:this.unstaged}},[this.unstaged.length?e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"add"},on:{click:t.add}},[t._v("Add")])],1):t._e()],1)],1),e("k-column",{attrs:{width:"1/3"}},[e("changes-list",{attrs:{title:"Staged",data:this.staged}},[this.staged.length?e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"circle-filled"},on:{click:function(i){return t.$refs.commitDialog.open()}}},[t._v("Commit")])],1):t._e()],1),e("k-dialog",{ref:"commitDialog",attrs:{theme:"positive"},on:{submit:function(i){return t.$refs.commitForm.submit()}}},[e("k-form",{ref:"commitForm",attrs:{fields:{message:{type:"text",label:"Message",required:!0}}},on:{submit:t.commit},model:{value:t.commitData,callback:function(i){t.commitData=i},expression:"commitData"}})],1)],1),e("k-column",{attrs:{width:"1/3"}},[e("commits-list",{attrs:{data:t.logData},on:{paginate:t.paginateLog}},[e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"download",disabled:!t.canPull},on:{click:t.pull}},[t._v(" "+t._s(t.isPulling?"Pulling\u2026":"Pull")+" ")]),e("k-button",{attrs:{icon:"upload",theme:"positive",disabled:!t.canPush},on:{click:t.push}},[t._v(" "+t._s(t.isPushing?"Pushing\u2026":"Push")+" ")])],1)],1)],1)],1)],1)],1)},G=[];const H={components:{ChangesList:j,CommitsList:V},data(){return{staged:[],unstaged:[],commitData:{message:null},logData:null,logPgn:null,isPulling:!1,isPushing:!1}},computed:{canPull(){return!this.isPushing&&!this.isPulling},canPush(){var t;return!this.isPushing&&!this.isPulling&&((t=this.logData)==null?void 0:t.new)}},created(){this.$api.get("git/status").then(t=>{this.updateStatus(t)}).catch(t=>{this.$store.dispatch("notification/error",t)})},methods:{updateStatus(t){this.staged=[],this.unstaged=[],t.forEach(s=>{s.unstaged&&this.unstaged.push({file:s.file,mode:s.unstaged}),s.staged&&s.staged!=="?"&&this.staged.push({file:s.file,mode:s.staged})})},add(){this.$api.post("git/add").then(()=>this.$api.get("git/status")).then(t=>{this.updateStatus(t)})},commit(){this.$api.post("git/commit",this.commitData).then(()=>(this.$refs.commitDialog.close(),this.$api.get("git/status"))).then(t=>{this.commitData.message=null,this.updateStatus(t)}).catch(t=>{this.$refs.commitDialog.error(t.message)}).then(()=>{this.listCommits()})},paginateLog(t){this.logPgn={page:t.page,limit:t.limit},this.listCommits()},listCommits(){return this.$api.get("git/log",this.logPgn).then(t=>{this.logData=t})},push(){this.isPushing=!0,this.$api.post("git/push").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPushing=!1})},pull(){this.isPulling=!0,this.$api.get("git/pull").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPulling=!1})}}},_={};var X=a(H,U,G,!1,q,null,null,null);function q(t){for(let s in _)this[s]=_[s]}var z=function(){return X.exports}();panel.plugin("oblik/git",{sections:{git:y},components:{"k-git-view":z}})})();})();
