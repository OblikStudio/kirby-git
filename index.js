(()=>{(function(){"use strict";var k=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"area-git-changes-list"},[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v(t._s(t.finalHeadline))]),t.list.length?e("k-button-group",[e("k-button",{attrs:{icon:"share",link:t.link}},[t._v("Open")])],1):t._e()],1),t.list.length?e("k-items",t._l(t.list,function(i){return e("k-item",{key:i.image.icon,attrs:{text:i.text,image:i.image}})}),1):[e("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])]],2)},$=[];function l(t,s,e,i,r,p,_,G){var a=typeof t=="function"?t.options:t;s&&(a.render=s,a.staticRenderFns=e,a._compiled=!0),i&&(a.functional=!0),p&&(a._scopeId="data-v-"+p);var o;if(_?(o=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(n=__VUE_SSR_CONTEXT__),r&&r.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(_)},a._ssrRegister=o):r&&(o=G?function(){r.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(a.functional){a._injectStyles=o;var H=a.render;a.render=function(X,v){return o.call(v),H(X,v)}}else{var f=a.beforeCreate;a.beforeCreate=f?[].concat(f,o):[o]}return{exports:t,options:a}}const c=["site.changeTitle","page.changeTitle","page.changeStatus","model.update"];function u(){return{total:0,added:0,untracked:0,modified:0,renamed:0,deleted:0}}const b={data:()=>({headline:null,stats:u()}),computed:{finalHeadline(){let t=this.headline;return this.stats.total&&(t+=` (${this.stats.total} changes)`),t},link(){return window.panel.$url("git").toString()},positiveStatus(){let t=[];return this.stats.added&&t.push(`${this.stats.added} added`),this.stats.untracked&&t.push(`${this.stats.untracked} untracked`),t.length?t.join(", "):null},noticeStatus(){let t=[];return this.stats.modified&&t.push(`${this.stats.modified} modified`),this.stats.renamed&&t.push(`${this.stats.renamed} renamed`),t.length?t.join(", "):null},negativeStatus(){return this.stats.deleted?`${this.stats.deleted} deleted`:null},list(){let t=[];return this.positiveStatus&&t.push({text:this.positiveStatus,image:{icon:"copy",back:"var(--color-positive)",color:"var(--color-gray-800)"}}),this.noticeStatus&&t.push({text:this.noticeStatus,image:{icon:"edit",back:"var(--color-notice)",color:"var(--color-gray-800)"}}),this.negativeStatus&&t.push({text:this.negativeStatus,image:{icon:"trash",back:"var(--color-negative)",color:"var(--color-gray-800)"}}),t}},created(){this.headline=this.$attrs.headline,this.status(),c.forEach(t=>this.$events.$on(t,this.status))},destroyed(){c.forEach(t=>this.$events.$off(t,this.status))},methods:{status(){this.$api.get("git/status").then(t=>{this.stats=u(),t.length&&this.updateStats(t)})},updateStats(t){this.stats.total=t.length,t.forEach(s=>{switch(s.staged||s.unstaged){case"A":this.stats.added++;break;case"?":this.stats.untracked++;break;case"M":this.stats.modified++;break;case"R":this.stats.renamed++;break;case"D":this.stats.deleted++}})}}},h={};var P=l(b,k,$,!1,S,null,null,null);function S(t){for(let s in h)this[s]=h[s]}var C=function(){return P.exports}(),x=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",{staticClass:"area-git-changes-list"},[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v(t._s(t.title))]),t._t("action")],2),t.entries?e("k-items",t._l(t.entries,function(i){return e("k-item",{key:i.file,attrs:{text:i.file,image:i.image}})}),1):[e("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])],e("k-pagination",{attrs:{align:"center",details:!0,page:t.pageIdx+1,total:t.data.length,limit:t.perPage},on:{paginate:t.changePage}})],2)},D=[];const w={props:{title:{type:String},data:{type:Array}},data(){return{perPage:15,pageIdx:0}},computed:{pages(){return this.data.reduce((t,s,e)=>{let i=Math.floor(e/this.perPage);return(t[i]||(t[i]=[])).push(s),t},[])},page(){return this.pages[this.pageIdx]||(this.pageIdx=0),this.pages[this.pageIdx]},entries(){return this.page?this.page.map(t=>{let s={back:"black",icon:"question",color:"var(--color-gray-800)"};switch(t.mode){case"?":case"A":s.back="var(--color-positive)",s.icon="copy";break;case"M":s.back="var(--color-notice)",s.icon="edit";break;case"R":s.back="var(--color-notice)",s.icon="refresh";break;case"D":s.back="var(--color-negative)",s.icon="trash"}return{file:t.file,mode:t.mode,image:s}}):null}},methods:{changePage(t){this.pageIdx=t.page-1}}},d={};var y=l(w,x,D,!1,E,null,null,null);function E(t){for(let s in d)this[s]=d[s]}var R=function(){return y.exports}(),M=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("section",[e("header",{staticClass:"k-section-header"},[e("k-headline",[t._v("Commits")]),t._t("action")],2),t.data&&t.data.commits.length?e("k-items",t._l(t.data.commits,function(i){return e("k-item",{key:i.hash,attrs:{text:i.subject,info:i.hash,image:{back:i.new?"green":"black",icon:i.new?"upload":"circle-filled",color:i.new?"gray-800":"gray-500"}}})}),1):[e("k-empty",{attrs:{icon:"circle-filled"}},[t._v("No commits")])],t.data?e("k-pagination",t._g({attrs:{align:"center",details:!0,page:t.page,total:t.data.total,limit:t.limit}},t.$listeners)):t._e()],2)},T=[],z="";const F={props:{data:Object},data(){return{page:1,limit:15}},created(){this.$emit("paginate",{page:this.page,limit:this.limit})}},g={};var j=l(F,M,T,!1,I,"ed535868",null,null);function I(t){for(let s in g)this[s]=g[s]}var N=function(){return j.exports}(),A=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("k-inside",[e("k-view",[e("k-header",[t._v("Version Control")]),e("k-grid",{attrs:{gutter:"medium"}},[e("k-column",{attrs:{width:"1/3"}},[e("changes-list",{attrs:{title:"Unstaged",data:this.unstaged}},[this.unstaged.length?e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"add"},on:{click:t.add}},[t._v("Add")])],1):t._e()],1)],1),e("k-column",{attrs:{width:"1/3"}},[e("changes-list",{attrs:{title:"Staged",data:this.staged}},[this.staged.length?e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"circle-filled"},on:{click:function(i){return t.$refs.commitDialog.open()}}},[t._v(" Commit ")])],1):t._e()],1),e("k-dialog",{ref:"commitDialog",attrs:{theme:"positive"},on:{submit:function(i){return t.$refs.commitForm.submit()}}},[e("k-form",{ref:"commitForm",attrs:{fields:{message:{type:"text",label:"Message",required:!0}}},on:{submit:t.commit},model:{value:t.commitData,callback:function(i){t.commitData=i},expression:"commitData"}})],1)],1),e("k-column",{attrs:{width:"1/3"}},[e("commits-list",{attrs:{data:t.logData},on:{paginate:t.paginateLog}},[e("k-button-group",{attrs:{slot:"action"},slot:"action"},[e("k-button",{attrs:{icon:"download",disabled:!t.canPull},on:{click:t.pull}},[t._v(" "+t._s(t.isPulling?"Pulling\u2026":"Pull")+" ")]),e("k-button",{attrs:{icon:"upload",theme:"positive",disabled:!t.canPush},on:{click:t.push}},[t._v(" "+t._s(t.isPushing?"Pushing\u2026":"Push")+" ")])],1)],1)],1)],1)],1)],1)},L=[];const V={components:{ChangesList:R,CommitsList:N},data(){return{staged:[],unstaged:[],commitData:{message:null},logData:null,logPgn:null,isPulling:!1,isPushing:!1}},computed:{canPull(){return!this.isPushing&&!this.isPulling},canPush(){var t;return!this.isPushing&&!this.isPulling&&((t=this.logData)==null?void 0:t.new)}},created(){this.$api.get("git/status").then(t=>{this.updateStatus(t)}).catch(t=>{this.$store.dispatch("notification/error",t)})},methods:{updateStatus(t){this.staged=[],this.unstaged=[],t.forEach(s=>{s.unstaged&&this.unstaged.push({file:s.file,mode:s.unstaged}),s.staged&&s.staged!=="?"&&this.staged.push({file:s.file,mode:s.staged})})},add(){this.$api.post("git/add").then(()=>this.$api.get("git/status")).then(t=>{this.updateStatus(t)})},commit(){this.$api.post("git/commit",this.commitData).then(()=>(this.$refs.commitDialog.close(),this.$api.get("git/status"))).then(t=>{this.commitData.message=null,this.updateStatus(t)}).catch(t=>{this.$refs.commitDialog.error(t.message)}).then(()=>{this.listCommits()})},paginateLog(t){this.logPgn={page:t.page,limit:t.limit},this.listCommits()},listCommits(){return this.$api.get("git/log",this.logPgn).then(t=>{this.logData=t})},push(){this.isPushing=!0,this.$api.post("git/push").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPushing=!1})},pull(){this.isPulling=!0,this.$api.get("git/pull").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPulling=!1})}}},m={};var O=l(V,A,L,!1,U,null,null,null);function U(t){for(let s in m)this[s]=m[s]}var q=function(){return O.exports}();panel.plugin("oblik/git",{sections:{git:C},components:{"k-git-view":q}})})();})();
