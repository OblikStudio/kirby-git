(function(){"use strict";var k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"area-git-changes-list"},[s("header",{staticClass:"k-section-header"},[s("k-headline",[t._v(t._s(t.finalHeadline))]),t.list.length?s("k-button-group",[s("k-button",{attrs:{icon:"share",link:t.link}},[t._v("Open")])],1):t._e()],1),t.list.length?s("k-items",{attrs:{items:t.list}}):[s("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])]],2)},$=[];function l(t,e,s,n,r,m,_,G){var i=typeof t=="function"?t.options:t;e&&(i.render=e,i.staticRenderFns=s,i._compiled=!0),n&&(i.functional=!0),m&&(i._scopeId="data-v-"+m);var o;if(_?(o=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(a=__VUE_SSR_CONTEXT__),r&&r.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(_)},i._ssrRegister=o):r&&(o=G?function(){r.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(i.functional){i._injectStyles=o;var H=i.render;i.render=function(X,v){return o.call(v),H(X,v)}}else{var f=i.beforeCreate;i.beforeCreate=f?[].concat(f,o):[o]}return{exports:t,options:i}}const c=["site.changeTitle","page.changeTitle","page.changeStatus","model.update"];function u(){return{total:0,added:0,untracked:0,modified:0,renamed:0,deleted:0}}const b={data:()=>({headline:null,stats:u()}),computed:{finalHeadline(){let t=this.headline;return this.stats.total&&(t+=` (${this.stats.total} changes)`),t},link(){return window.panel.$url("git").toString()},positiveStatus(){let t=[];return this.stats.added&&t.push(`${this.stats.added} added`),this.stats.untracked&&t.push(`${this.stats.untracked} untracked`),t.length?t.join(", "):null},noticeStatus(){let t=[];return this.stats.modified&&t.push(`${this.stats.modified} modified`),this.stats.renamed&&t.push(`${this.stats.renamed} renamed`),t.length?t.join(", "):null},negativeStatus(){return this.stats.deleted?`${this.stats.deleted} deleted`:null},list(){let t=[];return this.positiveStatus&&t.push({text:this.positiveStatus,image:{icon:"copy",back:"var(--color-positive)",color:"var(--color-gray-800)"}}),this.noticeStatus&&t.push({text:this.noticeStatus,image:{icon:"edit",back:"var(--color-notice)",color:"var(--color-gray-800)"}}),this.negativeStatus&&t.push({text:this.negativeStatus,image:{icon:"trash",back:"var(--color-negative)",color:"var(--color-gray-800)"}}),t.map(e=>({...e,key:e.image.icon}))}},created(){this.load().then(t=>{this.headline=t.headline,this.status()}),c.forEach(t=>this.$events.$on(t,this.status))},destroyed(){c.forEach(t=>this.$events.$off(t,this.status))},methods:{status(){this.$api.get("git/status").then(t=>{this.stats=u(),t.length&&this.updateStats(t)})},updateStats(t){this.stats.total=t.length,t.forEach(e=>{switch(e.staged||e.unstaged){case"A":this.stats.added++;break;case"?":this.stats.untracked++;break;case"M":this.stats.modified++;break;case"R":this.stats.renamed++;break;case"D":this.stats.deleted++}})}}},h={};var P=l(b,k,$,!1,S,null,null,null);function S(t){for(let e in h)this[e]=h[e]}var C=function(){return P.exports}(),x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"area-git-changes-list"},[s("header",{staticClass:"k-section-header"},[s("k-headline",[t._v(t._s(t.title))]),t._t("action")],2),t.entries?s("k-items",{attrs:{items:t.entries}}):[s("k-empty",{attrs:{icon:"check"}},[t._v("No changes")])],s("k-pagination",{attrs:{align:"center",details:!0,page:t.pageIdx+1,total:t.data.length,limit:t.perPage},on:{paginate:t.changePage}})],2)},D=[];const w={props:{title:{type:String},data:{type:Array}},data(){return{perPage:15,pageIdx:0}},computed:{pages(){return this.data.reduce((t,e,s)=>{let n=Math.floor(s/this.perPage);return(t[n]||(t[n]=[])).push(e),t},[])},page(){return this.pages[this.pageIdx]||(this.pageIdx=0),this.pages[this.pageIdx]},entries(){return this.page?this.page.map(t=>{let e={back:"black",icon:"question",color:"var(--color-gray-800)"};switch(t.mode){case"?":case"A":e.back="var(--color-positive)",e.icon="copy";break;case"M":e.back="var(--color-notice)",e.icon="edit";break;case"R":e.back="var(--color-notice)",e.icon="refresh";break;case"D":e.back="var(--color-negative)",e.icon="trash"}return{text:t.file,image:e}}):null}},methods:{changePage(t){this.pageIdx=t.page-1}}},d={};var y=l(w,x,D,!1,E,null,null,null);function E(t){for(let e in d)this[e]=d[e]}var R=function(){return y.exports}(),I=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",[s("header",{staticClass:"k-section-header"},[s("k-headline",[t._v("Commits")]),t._t("action")],2),t.listItems?s("k-items",{attrs:{items:t.listItems}}):[s("k-empty",{attrs:{icon:"circle-filled"}},[t._v("No commits")])],t.data?s("k-pagination",t._g({attrs:{align:"center",details:!0,page:t.page,total:t.data.total,limit:t.limit}},t.$listeners)):t._e()],2)},M=[],z="";const T={props:{data:Object},data(){return{page:1,limit:15}},computed:{listItems(){var t;return(t=this.data)==null?void 0:t.commits.map(e=>({key:e.hash,text:e.subject,info:e.hash,image:{back:e.new?"green":"black",icon:e.new?"upload":"circle-filled",color:e.new?"gray-800":"gray-500"}}))}},created(){this.$emit("paginate",{page:this.page,limit:this.limit})}},g={};var F=l(T,I,M,!1,j,"53c37a36",null,null);function j(t){for(let e in g)this[e]=g[e]}var N=function(){return F.exports}(),A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("k-inside",[s("k-view",[s("k-header",[t._v("Version Control")]),s("k-grid",{attrs:{gutter:"medium"}},[s("k-column",{attrs:{width:"1/3"}},[s("changes-list",{attrs:{title:"Unstaged",data:this.unstaged}},[this.unstaged.length?s("k-button-group",{attrs:{slot:"action"},slot:"action"},[s("k-button",{attrs:{icon:"add"},on:{click:t.add}},[t._v("Add")])],1):t._e()],1)],1),s("k-column",{attrs:{width:"1/3"}},[s("changes-list",{attrs:{title:"Staged",data:this.staged}},[this.staged.length?s("k-button-group",{attrs:{slot:"action"},slot:"action"},[s("k-button",{attrs:{icon:"circle-filled"},on:{click:function(n){return t.$refs.commitDialog.open()}}},[t._v(" Commit ")])],1):t._e()],1),s("k-dialog",{ref:"commitDialog",attrs:{theme:"positive"},on:{submit:function(n){return t.$refs.commitForm.submit()}}},[s("k-form",{ref:"commitForm",attrs:{fields:{message:{type:"text",label:"Message",required:!0}}},on:{submit:t.commit},model:{value:t.commitData,callback:function(n){t.commitData=n},expression:"commitData"}})],1)],1),s("k-column",{attrs:{width:"1/3"}},[s("commits-list",{attrs:{data:t.logData},on:{paginate:t.paginateLog}},[s("k-button-group",{attrs:{slot:"action"},slot:"action"},[s("k-button",{attrs:{icon:"download",disabled:!t.canPull},on:{click:t.pull}},[t._v(" "+t._s(t.isPulling?"Pulling\u2026":"Pull")+" ")]),s("k-button",{attrs:{icon:"upload",theme:"positive",disabled:!t.canPush},on:{click:t.push}},[t._v(" "+t._s(t.isPushing?"Pushing\u2026":"Push")+" ")])],1)],1)],1)],1)],1)],1)},L=[];const V={components:{ChangesList:R,CommitsList:N},data(){return{staged:[],unstaged:[],commitData:{message:null},logData:null,logPgn:null,isPulling:!1,isPushing:!1}},computed:{canPull(){return!this.isPushing&&!this.isPulling},canPush(){var t;return!this.isPushing&&!this.isPulling&&((t=this.logData)==null?void 0:t.new)}},created(){this.$api.get("git/status").then(t=>{this.updateStatus(t)}).catch(t=>{this.$store.dispatch("notification/error",t)})},methods:{updateStatus(t){this.staged=[],this.unstaged=[],t.forEach(e=>{e.unstaged&&this.unstaged.push({file:e.file,mode:e.unstaged}),e.staged&&e.staged!=="?"&&this.staged.push({file:e.file,mode:e.staged})})},add(){this.$api.post("git/add").then(()=>this.$api.get("git/status")).then(t=>{this.updateStatus(t)})},commit(){this.$api.post("git/commit",this.commitData).then(()=>(this.$refs.commitDialog.close(),this.$api.get("git/status"))).then(t=>{this.commitData.message=null,this.updateStatus(t)}).catch(t=>{this.$refs.commitDialog.error(t.message)}).then(()=>{this.listCommits()})},paginateLog(t){this.logPgn={page:t.page,limit:t.limit},this.listCommits()},listCommits(){return this.$api.get("git/log",this.logPgn).then(t=>{this.logData=t})},push(){this.isPushing=!0,this.$api.post("git/push").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPushing=!1})},pull(){this.isPulling=!0,this.$api.get("git/pull").then(()=>this.listCommits()).catch(t=>{this.$store.dispatch("notification/error",t)}).then(()=>{this.isPulling=!1})}}},p={};var O=l(V,A,L,!1,U,null,null,null);function U(t){for(let e in p)this[e]=p[e]}var q=function(){return O.exports}();panel.plugin("oblik/git",{sections:{git:C},components:{"k-git-view":q}})})();
